{"version":3,"file":"stellar-wallets-kit.js","sources":["../src/stellar-wallets-kit.ts"],"sourcesContent":["import { StellarWalletsButton } from './components/button/stellar-wallets-button';\nimport { StellarWalletsModal } from './components/modal/stellar-wallets-modal';\nimport {\n  removeAddress,\n  seButtonTheme,\n  setAddress,\n  setAllowedWallets,\n  setHorizonUrl,\n  setModalTheme,\n  setNetwork,\n  setSelectedModuleId,\n  store,\n} from './state/store';\nimport { IButtonTheme, ISupportedWallet, IModalTheme, KitActions, ModuleInterface, WalletNetwork } from './types';\n\nexport interface StellarWalletsKitParams {\n  selectedWalletId: string;\n  network: WalletNetwork;\n  modules: ModuleInterface[];\n  /**\n   * @deprecated - This parameter will be removed in a future release, use `modalTheme` instead\n   */\n  theme?: IModalTheme;\n  modalTheme?: IModalTheme;\n  buttonTheme?: IButtonTheme;\n}\n\nexport class StellarWalletsKit implements KitActions {\n  private buttonElement?: StellarWalletsButton;\n  private modalElement?: StellarWalletsModal;\n  private readonly modules: ModuleInterface[];\n\n  private get selectedModule(): ModuleInterface {\n    const target: ModuleInterface | undefined = this.modules.find(\n      (mod: ModuleInterface): boolean => mod.productId === store.getValue().selectedModuleId\n    );\n\n    if (!target) {\n      throw { code: -3, message: 'Please set the wallet first' };\n    }\n\n    return target;\n  }\n\n  constructor(params: StellarWalletsKitParams) {\n    this.modules = params.modules;\n    this.setWallet(params.selectedWalletId);\n    setNetwork(params.network);\n\n    const modalTheme: IModalTheme | undefined = params.theme || params.modalTheme;\n    if (modalTheme) {\n      setModalTheme(modalTheme);\n    }\n\n    if (params.buttonTheme) {\n      seButtonTheme(params.buttonTheme);\n    }\n\n    this.getSupportedWallets().then((value: ISupportedWallet[]): void => {\n      setAllowedWallets(value);\n    });\n  }\n\n  /**\n   * This method will return an array with all wallets supported by this kit but will let you know those the user have already installed/has access to\n   * There are wallets that are by default available since they either don't need to be installed or have a fallback\n   */\n  public async getSupportedWallets(): Promise<ISupportedWallet[]> {\n    return Promise.all(\n      this.modules.map(async (mod: ModuleInterface): Promise<ISupportedWallet> => {\n        const timer: Promise<false> = new Promise(r => setTimeout(() => r(false), 500));\n        return {\n          id: mod.productId,\n          name: mod.productName,\n          type: mod.moduleType,\n          icon: mod.productIcon,\n          isAvailable: await Promise.race([timer, mod.isAvailable()]),\n          url: mod.productUrl,\n        };\n      })\n    );\n  }\n\n  public setWallet(id: string): void {\n    const target: ModuleInterface | undefined = this.modules.find(\n      (mod: ModuleInterface): boolean => mod.productId === id\n    );\n\n    if (!target) {\n      throw new Error(`Wallet id \"${id}\" is not supported`);\n    }\n\n    setSelectedModuleId(target.productId);\n  }\n\n  public async getAddress(params?: { path?: string }): Promise<{ address: string }> {\n    const { address } = await this.selectedModule.getAddress(params);\n    setAddress(address);\n    return { address };\n  }\n\n  public async signTransaction(\n    xdr: string,\n    opts?: {\n      networkPassphrase?: string;\n      address?: string;\n      path?: string;\n      submit?: boolean;\n      submitUrl?: string;\n    }\n  ): Promise<{ signedTxXdr: string; signerAddress?: string }> {\n    return this.selectedModule.signTransaction(xdr, {\n      ...opts,\n      networkPassphrase: opts?.networkPassphrase || store.getValue().selectedNetwork,\n    });\n  }\n\n  public async signAuthEntry(\n    authEntry: string,\n    opts?: {\n      networkPassphrase?: string;\n      address?: string;\n      path?: string;\n    }\n  ): Promise<{ signedAuthEntry: string; signerAddress?: string }> {\n    return this.selectedModule.signAuthEntry(authEntry, {\n      ...opts,\n      networkPassphrase: opts?.networkPassphrase || store.getValue().selectedNetwork,\n    });\n  }\n\n  public async signMessage(\n    message: string,\n    opts?: {\n      networkPassphrase?: string;\n      address?: string;\n      path?: string;\n    }\n  ): Promise<{ signedMessage: string; signerAddress?: string }> {\n    return this.selectedModule.signMessage(message, {\n      ...opts,\n      networkPassphrase: opts?.networkPassphrase || store.getValue().selectedNetwork,\n    });\n  }\n\n  async getNetwork(): Promise<{ network: string; networkPassphrase: string }> {\n    return this.selectedModule.getNetwork();\n  }\n\n  async disconnect(): Promise<void> {\n    removeAddress();\n  }\n\n  // ---- Button methods\n  public isButtonCreated(): boolean {\n    return !!this.buttonElement;\n  }\n\n  public async createButton(params: {\n    container: HTMLElement;\n    onConnect: (response: { address: string }) => void;\n    onDisconnect: () => void;\n    horizonUrl?: string;\n    buttonText?: string;\n  }): Promise<void> {\n    if (this.buttonElement) {\n      throw new Error(`Stellar Wallets Kit button is already created`);\n    }\n\n    this.buttonElement = document.createElement('stellar-wallets-button') as StellarWalletsButton;\n\n    if (params.buttonText) {\n      this.buttonElement.setAttribute('buttonText', params.buttonText);\n    }\n\n    if (params.horizonUrl) {\n      setHorizonUrl(params.horizonUrl);\n    }\n\n    params.container.appendChild(this.buttonElement);\n\n    this.buttonElement.addEventListener(\n      'button-clicked',\n      () => {\n        this.openModal({\n          onWalletSelected: option => {\n            setSelectedModuleId(option.id);\n            this.getAddress().then((r: { address: string }) => params.onConnect(r));\n          },\n        });\n      },\n      false\n    );\n\n    this.buttonElement.addEventListener(\n      'disconnect-wallet',\n      () => {\n        params.onDisconnect();\n\n        if (this.selectedModule.disconnect) {\n          this.selectedModule.disconnect();\n        }\n      },\n      false\n    );\n  }\n\n  /**\n   * Removes the button elements from the HTML and from the kit's instance.\n   *\n   * @param params.skipDisconnect - Set this to `true` if you want to prevent that we disconnect (for example, disconnecting WalletConnect or removing the address)\n   */\n  public async removeButton(params?: { skipDisconnect?: boolean }): Promise<void> {\n    if (!this.buttonElement) {\n      throw new Error(`Stellar Wallets Kit button hasn't been created yet`);\n    }\n\n    if (params?.skipDisconnect !== true) {\n      this.buttonElement.disconnect();\n    }\n\n    this.buttonElement.remove();\n    delete this.buttonElement;\n  }\n  // ---- END Button methods\n\n  // ---- Modal methods\n  public async openModal(params: {\n    onWalletSelected: (option: ISupportedWallet) => void;\n    onClosed?: (err: Error) => void;\n    modalTitle?: string;\n    notAvailableText?: string;\n  }): Promise<void> {\n    if (this.modalElement && !this.buttonElement) {\n      throw new Error(`Stellar Wallets Kit modal is already open`);\n    } else {\n      this.modalElement = document.createElement('stellar-wallets-modal') as StellarWalletsModal;\n    }\n\n    this.modalElement.setAttribute('showModal', '');\n\n    if (params.modalTitle) {\n      this.modalElement.setAttribute('modalTitle', params.modalTitle);\n    }\n\n    if (params.notAvailableText) {\n      this.modalElement.setAttribute('notAvailableText', params.notAvailableText);\n    }\n\n    document.body.appendChild(this.modalElement);\n\n    const listener = (event: CustomEvent) => {\n      params.onWalletSelected(event.detail);\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      this.modalElement.removeEventListener('wallet-selected', listener, false);\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      document.body.removeChild(this.modalElement);\n      this.modalElement = undefined;\n    };\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    this.modalElement.addEventListener('wallet-selected', listener, false);\n\n    const errorListener = (event: CustomEvent) => {\n      if (params.onClosed) {\n        params.onClosed(event.detail);\n      }\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      this.modalElement.removeEventListener('wallet-selected', listener, false);\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      this.modalElement.removeEventListener('modal-closed', errorListener, false);\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      document.body.removeChild(this.modalElement);\n      this.modalElement = undefined;\n    };\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    this.modalElement.addEventListener('modal-closed', errorListener, false);\n  }\n  // ---- END Modal methods\n}\n"],"names":["StellarWalletsKit","selectedModule","target","this","modules","find","mod","productId","store","getValue","selectedModuleId","code","message","constructor","params","setWallet","selectedWalletId","setNetwork","network","modalTheme","theme","setModalTheme","buttonTheme","seButtonTheme","getSupportedWallets","then","value","setAllowedWallets","Promise","all","map","async","timer","r","setTimeout","id","name","productName","type","moduleType","icon","productIcon","isAvailable","race","url","productUrl","Error","setSelectedModuleId","getAddress","address","setAddress","signTransaction","xdr","opts","networkPassphrase","selectedNetwork","signAuthEntry","authEntry","signMessage","getNetwork","disconnect","removeAddress","isButtonCreated","buttonElement","createButton","document","createElement","buttonText","setAttribute","horizonUrl","setHorizonUrl","container","appendChild","addEventListener","openModal","onWalletSelected","option","onConnect","onDisconnect","removeButton","skipDisconnect","remove","modalElement","modalTitle","notAvailableText","body","listener","event","detail","removeEventListener","removeChild","errorListener","onClosed"],"mappings":"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"}