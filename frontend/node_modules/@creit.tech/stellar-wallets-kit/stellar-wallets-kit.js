import{store as e,setNetwork as t,setModalTheme as s,seButtonTheme as l,setAllowedWallets as n,setSelectedModuleId as o,setAddress as d,removeAddress as a,setHorizonUrl as r}from"./state/store.js";class i{get selectedModule(){const t=this.modules.find((t=>t.productId===e.getValue().selectedModuleId));if(!t)throw{code:-3,message:"Please set the wallet first"};return t}constructor(e){this.modules=e.modules,this.setWallet(e.selectedWalletId),t(e.network);const o=e.theme||e.modalTheme;o&&s(o),e.buttonTheme&&l(e.buttonTheme),this.getSupportedWallets().then((e=>{n(e)}))}async getSupportedWallets(){return Promise.all(this.modules.map((async e=>{const t=new Promise((e=>setTimeout((()=>e(!1)),500)));return{id:e.productId,name:e.productName,type:e.moduleType,icon:e.productIcon,isAvailable:await Promise.race([t,e.isAvailable()]),url:e.productUrl}})))}setWallet(e){const t=this.modules.find((t=>t.productId===e));if(!t)throw new Error(`Wallet id "${e}" is not supported`);o(t.productId)}async getAddress(e){const{address:t}=await this.selectedModule.getAddress(e);return d(t),{address:t}}async signTransaction(t,s){return this.selectedModule.signTransaction(t,{...s,networkPassphrase:s?.networkPassphrase||e.getValue().selectedNetwork})}async signAuthEntry(t,s){return this.selectedModule.signAuthEntry(t,{...s,networkPassphrase:s?.networkPassphrase||e.getValue().selectedNetwork})}async signMessage(t,s){return this.selectedModule.signMessage(t,{...s,networkPassphrase:s?.networkPassphrase||e.getValue().selectedNetwork})}async getNetwork(){return this.selectedModule.getNetwork()}async disconnect(){a()}isButtonCreated(){return!!this.buttonElement}async createButton(e){if(this.buttonElement)throw new Error("Stellar Wallets Kit button is already created");this.buttonElement=document.createElement("stellar-wallets-button"),e.buttonText&&this.buttonElement.setAttribute("buttonText",e.buttonText),e.horizonUrl&&r(e.horizonUrl),e.container.appendChild(this.buttonElement),this.buttonElement.addEventListener("button-clicked",(()=>{this.openModal({onWalletSelected:t=>{o(t.id),this.getAddress().then((t=>e.onConnect(t)))}})}),!1),this.buttonElement.addEventListener("disconnect-wallet",(()=>{e.onDisconnect(),this.selectedModule.disconnect&&this.selectedModule.disconnect()}),!1)}async removeButton(e){if(!this.buttonElement)throw new Error("Stellar Wallets Kit button hasn't been created yet");!0!==e?.skipDisconnect&&this.buttonElement.disconnect(),this.buttonElement.remove(),delete this.buttonElement}async openModal(e){if(this.modalElement&&!this.buttonElement)throw new Error("Stellar Wallets Kit modal is already open");this.modalElement=document.createElement("stellar-wallets-modal"),this.modalElement.setAttribute("showModal",""),e.modalTitle&&this.modalElement.setAttribute("modalTitle",e.modalTitle),e.notAvailableText&&this.modalElement.setAttribute("notAvailableText",e.notAvailableText),document.body.appendChild(this.modalElement);const t=s=>{e.onWalletSelected(s.detail),this.modalElement.removeEventListener("wallet-selected",t,!1),document.body.removeChild(this.modalElement),this.modalElement=void 0};this.modalElement.addEventListener("wallet-selected",t,!1);const s=l=>{e.onClosed&&e.onClosed(l.detail),this.modalElement.removeEventListener("wallet-selected",t,!1),this.modalElement.removeEventListener("modal-closed",s,!1),document.body.removeChild(this.modalElement),this.modalElement=void 0};this.modalElement.addEventListener("modal-closed",s,!1)}}export{i as StellarWalletsKit};
//# sourceMappingURL=stellar-wallets-kit.js.map
